pipeline {
    agent any

    environment {
        APP_SERVER = 'ec2-user@16.171.197.232'
        SSH_KEY_PATH = 'C:\\Users\\karun\\Downloads\\phase2.pem'   // âœ… Correct path to your PEM file
    }

    stages {

        stage('Deploy to EC2') {
            steps {
                bat """
                    ssh -i "%SSH_KEY_PATH%" -o StrictHostKeyChecking=no %APP_SERVER% ^
                    "docker pull kimai/kimai2:apache && docker stop kimai || true && docker rm kimai || true && docker run -d -p 8001:80 --name kimai kimai/kimai2:apache"
                """
            }
        }

    }
}
